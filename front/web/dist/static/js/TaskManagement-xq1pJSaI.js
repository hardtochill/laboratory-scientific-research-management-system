import{z,r as v,B as H,d as _,c,o,f as l,h as a,e as p,K as E,L as P,s as g,t as S,m as V,x as r,n as d,ah as O,j as h,ai as b,Z as T,_ as $}from"./index-VkklmaQD.js";import{T as A,g as L,a as U,b as j}from"./TaskItem-C_vdrVqX.js";const Z={class:"task-management"},q={class:"task-list"},J=["onClick"],Q={key:1,class:"spacer"},W={class:"task-name"},X={key:0,class:"sub-tasks"},Y={key:0,class:"loading"},ee={key:1},ae={key:0,class:"task-detail"},se={class:"dialog-footer"},te=z({__name:"TaskManagement",setup(le){const i={PENDING:0,PROCESSING:1,FINISHED:2,SKIPPED:3},y=e=>{switch(e){case i.PENDING:return"info";case i.PROCESSING:return"warning";case i.FINISHED:return"success";case i.SKIPPED:return"danger";default:return"info"}},I=e=>{switch(e){case i.PENDING:return"未开始";case i.PROCESSING:return"进行中";case i.FINISHED:return"已完成";case i.SKIPPED:return"已跳过";default:return"未知状态"}},N=v([]),f=v(!1),n=v(null),F=async()=>{try{const e=await L();N.value=e.data.map(s=>({...s,expanded:!1,loading:!1,hasSubTasks:!0,subTasks:[]}))}catch(e){T.error("加载任务列表失败"),console.error("加载任务列表失败:",e)}},x=async e=>{e.expanded||await G(e),e.expanded=!e.expanded},G=async e=>{if(!e.loading&&e.subTasks.length===0)try{e.loading=!0;const s=await U(e.taskId);e.subTasks=s.data.map(m=>({...m,expanded:!1,loading:!1,hasSubTasks:!0,subTasks:[],parentTaskId:e.taskId}))}catch(s){T.error("加载子任务失败"),console.error("加载子任务失败:",s)}finally{e.loading=!1}},w=async e=>{try{const s=await j(e.taskId);n.value=s.data,f.value=!0}catch(s){T.error("加载任务详情失败"),console.error("加载任务详情失败:",s)}},C=()=>{f.value=!1,n.value=null};return H(()=>{F()}),(e,s)=>{const m=_("el-button"),D=_("el-tag"),B=_("el-skeleton"),K=_("el-card"),u=_("el-descriptions-item"),M=_("el-descriptions"),R=_("el-dialog");return o(),c("div",Z,[l(K,null,{header:a(()=>s[1]||(s[1]=[p("div",{class:"card-header"},[p("span",null,"任务列表")],-1)])),default:a(()=>[p("div",q,[(o(!0),c(E,null,P(N.value,t=>(o(),c("div",{key:t.taskId,class:"task-item"},[p("div",{class:"task-row",onClick:k=>w(t)},[t.hasSubTasks?(o(),g(m,{key:0,type:"text",onClick:V(k=>x(t),["stop"]),icon:t.expanded?"el-icon-arrow-down":"el-icon-arrow-right"},null,8,["onClick","icon"])):(o(),c("span",Q)),p("span",W,r(t.taskName),1),l(D,{type:y(t.taskStatus),size:"small",class:"task-status"},{default:a(()=>[d(r(I(t.taskStatus)),1)]),_:2},1032,["type"]),t.hasSubTasks?(o(),g(m,{key:2,type:"primary",size:"small",onClick:V(k=>x(t),["stop"])},{default:a(()=>[d(r(t.expanded?"收起":"展开")+"子任务 ",1)]),_:2},1032,["onClick"])):S("",!0)],8,J),l(O,{name:"expand"},{default:a(()=>[t.expanded?(o(),c("div",X,[t.loading?(o(),c("div",Y,[l(B,{rows:3,animated:""})])):(o(),c("div",ee,[(o(!0),c(E,null,P(t.subTasks,k=>(o(),g(A,{key:k.taskId,task:k,onShowDetail:w},null,8,["task"]))),128))]))])):S("",!0)]),_:2},1024)]))),128))])]),_:1}),l(R,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=t=>f.value=t),title:"任务详情",width:"600px","before-close":C},{footer:a(()=>[p("div",se,[l(m,{onClick:C},{default:a(()=>s[2]||(s[2]=[d("关闭")])),_:1,__:[2]})])]),default:a(()=>[n.value?(o(),c("div",ae,[l(M,{column:1,border:""},{default:a(()=>[l(u,{label:"任务名称"},{default:a(()=>[d(r(n.value.taskName),1)]),_:1}),l(u,{label:"任务描述"},{default:a(()=>[d(r(n.value.taskDescription||"-"),1)]),_:1}),l(u,{label:"任务状态"},{default:a(()=>[l(D,{type:y(n.value.taskStatus)},{default:a(()=>[d(r(I(n.value.taskStatus)),1)]),_:1},8,["type"])]),_:1}),l(u,{label:"创建人"},{default:a(()=>[d(r(n.value.createNickName),1)]),_:1}),l(u,{label:"创建时间"},{default:a(()=>[d(r(h(b)(n.value.createTime)),1)]),_:1}),l(u,{label:"预期完成时间"},{default:a(()=>[d(r(h(b)(n.value.expectedFinishTime)),1)]),_:1}),l(u,{label:"实际完成时间"},{default:a(()=>[d(r(h(b)(n.value.actualFinishTime)||"-"),1)]),_:1}),l(u,{label:"备注"},{default:a(()=>[d(r(n.value.taskRemark||"-"),1)]),_:1})]),_:1})])):S("",!0)]),_:1},8,["modelValue"])])}}}),re=$(te,[["__scopeId","data-v-dcb406f3"]]);export{re as default};
