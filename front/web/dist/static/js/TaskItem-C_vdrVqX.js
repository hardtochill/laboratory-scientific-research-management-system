import{T as S,z as G,d as c,c as r,o as a,e as k,f as u,s as i,t as I,m as f,x as d,h as p,n as h,K as F,L as K,ah as O,Z as H,_ as R}from"./index-VkklmaQD.js";function J(){return S({url:"/task/parent-tasks",method:"get"})}function $(o){return S({url:`/task/sub-tasks/${o}`,method:"get"})}function Q(o){return S({url:`/task/${o}`,method:"get"})}const M={class:"task-item"},z={key:1,class:"spacer"},A={class:"task-name"},B={class:"progress-container"},V={key:0,class:"sub-tasks"},j={key:0,class:"loading"},L={key:1},x=G({__name:"TaskItem",props:{task:{}},emits:["show-detail"],setup(o,{emit:Z}){const t=o,e={PENDING:0,PROCESSING:1,FINISHED:2,SKIPPED:3},P=s=>{switch(s){case e.PENDING:return"info";case e.PROCESSING:return"warning";case e.FINISHED:return"success";case e.SKIPPED:return"danger";default:return"info"}},_=s=>{switch(s){case e.PENDING:return"未开始";case e.PROCESSING:return"进行中";case e.FINISHED:return"已完成";case e.SKIPPED:return"已跳过";default:return"未知状态"}},N=s=>{switch(s){case e.PENDING:return"#909399";case e.PROCESSING:return"#E6A23C";case e.FINISHED:return"#67C23A";case e.SKIPPED:return"#F56C6C";default:return"#909399"}},T=s=>{switch(s){case e.FINISHED:return"success";case e.SKIPPED:return"exception";case e.PROCESSING:return"active";default:return"normal"}},E=s=>{switch(s.taskStatus){case e.PENDING:return 0;case e.PROCESSING:return Math.floor(Math.random()*50)+10;case e.FINISHED:return 100;case e.SKIPPED:return 0;default:return 0}},m=async()=>{t.task.expanded||await w(),t.task.expanded=!t.task.expanded},w=async()=>{if(!t.task.loading&&t.task.subTasks.length===0)try{t.task.loading=!0;const s=await $(t.task.taskId);t.task.subTasks=s.data.map(n=>({...n,expanded:!1,loading:!1,hasSubTasks:!0,subTasks:[],parentTaskId:t.task.taskId}))}catch(s){H.error("加载子任务失败"),console.error("加载子任务失败:",s)}finally{t.task.loading=!1}};return(s,n)=>{const g=c("el-button"),y=c("el-tag"),D=c("el-progress"),C=c("el-skeleton"),b=c("TaskItem",!0);return a(),r("div",M,[k("div",{class:"task-row",onClick:n[0]||(n[0]=l=>s.$emit("show-detail",s.task))},[s.task.hasSubTasks?(a(),i(g,{key:0,type:"text",onClick:f(m,["stop"]),icon:s.task.expanded?"el-icon-arrow-down":"el-icon-arrow-right"},null,8,["icon"])):(a(),r("span",z)),k("span",A,d(s.task.taskName),1),u(y,{type:P(s.task.taskStatus),size:"small",class:"task-status"},{default:p(()=>[h(d(_(s.task.taskStatus)),1)]),_:1},8,["type"]),s.task.hasSubTasks?(a(),i(g,{key:2,type:"primary",size:"small",onClick:f(m,["stop"])},{default:p(()=>[h(d(s.task.expanded?"收起":"展开")+"子任务 ",1)]),_:1})):I("",!0)]),k("div",B,[u(D,{percentage:E(s.task),color:N(s.task.taskStatus),status:T(s.task.taskStatus),"stroke-width":8},null,8,["percentage","color","status"])]),u(O,{name:"expand"},{default:p(()=>[s.task.expanded?(a(),r("div",V,[s.task.loading?(a(),r("div",j,[u(C,{rows:3,animated:""})])):(a(),r("div",L,[(a(!0),r(F,null,K(s.task.subTasks,l=>(a(),i(b,{key:l.taskId,task:l,onShowDetail:n[1]||(n[1]=v=>s.$emit("show-detail",v))},null,8,["task"]))),128))]))])):I("",!0)]),_:1})])}}}),U=R(x,[["__scopeId","data-v-8c240819"]]),W=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));export{U as T,$ as a,Q as b,W as c,J as g};
