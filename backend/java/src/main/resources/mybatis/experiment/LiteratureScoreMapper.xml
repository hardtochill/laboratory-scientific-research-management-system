<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.experiment.mapper.LiteratureScoreMapper">

    <!-- 插入文献评分记录 -->
    <insert id="insertLiteratureScore">
        insert into literature_score(literature_id, user_id, score, create_time, update_time)
        values(#{literatureId}, #{userId}, #{score}, #{createTime}, #{updateTime})
    </insert>
    
    <!-- 更新文献的评分记录 -->
    <update id="updateLiteratureScore">
        update literature_score
        set score = #{score}, update_time = #{updateTime}
        where literature_id = #{literatureId} and user_id = #{userId}
    </update>
    
    <!-- 查询文献的教师评分统计 -->
    <select id="selectTeacherScoreStatistics" resultType="java.util.Map">
        select avg(ls.score) as avgScore, count(ls.id) as count
        from literature_score ls
        inner join sys_user u on ls.user_id = u.user_id
        inner join sys_user_role ur on u.user_id = ur.user_id
        inner join sys_role r on ur.role_id = r.role_id
        where ls.literature_id = #{literatureId} and r.role_name = 'teacher'
    </select>
    
    <!-- 查询文献的学生评分统计 -->
    <select id="selectStudentScoreStatistics" resultType="java.util.Map">
        select avg(ls.score) as avgScore, count(ls.id) as count
        from literature_score ls
        inner join sys_user u on ls.user_id = u.user_id
        inner join sys_user_role ur on u.user_id = ur.user_id
        inner join sys_role r on ur.role_id = r.role_id
        where ls.literature_id = #{literatureId} and r.role_name != 'teacher'
    </select>

</mapper>